# 日常记录应用 PRD

## 0. 概述
- **产品名称**：暂定为「K-Record」
- **定位**：一款以自我发展趋势为核心的日常记录应用，结合多维表格与 K 线可视化，帮助用户将事件与指标数据连接，生成长期趋势洞察。
- **首发平台**：网页端；需为后续 macOS/Windows 桌面端与 iOS/Android 移动端同步打下基础。
- **设计语言**：黑白极简，强调对比和留白，突出数据与内容。

## 1. 用户与痛点
| 用户画像 | 核心痛点 |
| --- | --- |
| 自我管理人群（健身、理财、情绪管理等） | 工具分散、数据难以统一展示，缺乏趋势洞察。 |
| 重视数据可控的隐私用户 | 不希望媒体素材存入云端数据库，迁移困难。 |
| 复盘型创作者 | 事件多、素材杂，需要快速回顾和总结。 |

## 2. 产品目标
1. 让用户在同一界面中记录事件与量化指标，并通过 K 线等图表洞察变化。
2. 所有文字/图片/视频严格使用用户指定的本地路径，保证数据可控、易迁移。
3. 建立可扩展的前后端架构，便于未来多端同步与插件生态。

## 3. 核心能力与需求拆解
### 3.1 日记/事件记录页
- 独立页面以日记形式呈现每日记录，按天聚合，支持富文本、标签、情绪、音频/视频/图片引用。
- 媒体文件不上传服务器，仅保存引用路径；允许用户为不同素材类型设置默认目录（macOS、Windows、外接盘等），侧边信息卡展示当日素材路径与指标摘要。
- 时间线支持日/周/月过滤、搜索（标签、情绪、关键词）以及快捷键创建条目。

### 3.2 多维表格页
- 采用多 Sheet 结构（如健康、情绪、财务等），每个 Sheet 对应一张可自定义字段的表格以及一个专属 K 线映射。
- 字段类型支持数值、文本、选择、公式、关联事件；可拖拽列顺序、批量填充和套用模版（身体管理、心情指数、财务收支等）。
- 支持批量导入/导出 CSV、JSON；导出同时生成 manifest，记录附件引用关系，方便迁移后重建索引。

### 3.3 趋势/K 线页
- 独立趋势页面提供单指标展示与聚合模式：单指标显示对应 Sheet 的 K 线，聚合模式可叠加多个指标（身心、财务+心态等）。
- 采用烛台（K 线）绘制，每一日都有热点节点；悬浮可看到日期、涨跌幅、事件数量，点击后在页面右侧展开「事件面板」，展示当日所有关联事件的小日记卡片。
- 支持在趋势页中保存多组组合模板，并可切换不同组合的 K 线预览。

### 3.4 数据管理与迁移
- 所有结构化数据存于客户端 SQLite/JSON（可选加密），媒体走文件系统。
- 提供一键备份/恢复，生成包含数据库与附件 manifest 的压缩包。
- 支持设置数据根目录、更换磁盘后重建索引，保证跨设备迁移的可读性。

### 3.5 同步与扩展
- 首版仅本地浏览器运行，保留 API 接口设计（GraphQL/REST），以便未来桌面端直接访问本地数据，移动端通过可选云同步服务。
- 预留插件接口，可导入可穿戴设备数据、银行流水等，将外部数据映射到指标表。

### 3.6 视觉标签画布页（新）
- 目标：在一张用户自选的背景图上，放置可视化“标签球”，承载关键词和关联日记，支持拖拽排布，用于情绪/价值观/项目地图的直观呈现。
- 数据模型：`{ id, label, content, diaryId?, x, y, color, size, shape, borderStyle, zIndex, locked }`；`x/y` 以百分比记录便于自适应，`content` 用于短文案，`diaryId` 关联已有日记条目。
- 页面布局：左侧/中央画布（背景图 + 绝对定位小球），右侧“标签列表 + 属性面板”，顶部工具栏提供“上传/更换图片、保存布局、撤销/重做”。
- 交互：
  - 添加小球：右侧按钮或快捷键，生成默认样式并自动选中。
  - 移动/锁定：拖拽或键盘微调；锁定后禁用拖拽；支持 zIndex 调整。
  - 编辑：右侧面板可改文字、颜色、大小、形状（圆/胶囊）、描边样式；支持删除。
  - 详情：点击球弹出气泡/侧栏展示 `content` 和“查看关联日记”入口（跳转或弹出 `DiaryModal`）。
  - 位置保存：拖拽结束即保存 `x/y`（百分比）、样式等；窗口缩放后位置保持。
- 数据存储/接口：前端状态管理（Zustand/Redux）+ 本地持久化；提供 `GET/POST /vision-notes`（包含背景图 URL、球列表 JSON）。背景图仅存引用路径，不上云。
- 样式指引：沿用日记 UI 色板与圆角/阴影，选中态有描边/发光；文字限制 6-8 字，溢出省略号；可选轻微漂浮动画提升氛围。

## 4. 信息架构 & 关键界面
1. **顶部导航**：日记 / 表格 / 趋势 / 设置（与 demo 原型保持一致）。
2. **日记页**：以天为单位展示记录卡片，左侧是时间线、右侧为当日概要（素材路径、标签 Top、情绪河流、关联指标）。
3. **表格页（多 Sheet）**：顶部 Tabs 切换 Sheet，主区域为表格 + 下方 K 线预览，侧边展示关键指标或关联图表。
4. **趋势页**：包含单指标 K 线（带热点、悬浮提示、事件抽屉）与聚合模式 K 线，同时在下方提供组合模板库。
5. **设置页**：数据目录、同步策略、导入导出、主题（黑/白）、安全（访问密码、本地加密）。

## 5. 用户流程
1. 首次使用 → 选择/创建数据目录 → 初始化默认模版。
2. 记录事件 → 填写文本、添加媒体引用、标注情绪/标签 → 同时勾选关联到指定指标。
3. 指标表自动更新 → 趋势页生成对应 K 线 → 用户通过悬浮窗查看摘要，点击查看详细事件。
4. 周期复盘 → 导出报告（图表 + 文字洞察）或备份数据包。

## 6. 技术方案概述
- **前端**：React + Zustand/Redux 管理状态，使用 ECharts/Highcharts 渲染 K 线；Tauri/Electron 为未来桌面端落地。
- **本地数据层**：IndexedDB + WASM SQLite，同步 manifest 记录文件引用；提供 Service Worker 处理备份导出。
- **文件系统**：通过浏览器原生 File System Access API（桌面端）或桌面客户端直接访问；移动端计划通过本地沙箱 + 云端映射。
- **API 设计**：即使首版本地运行，也定义统一 schema，方便未来多端共享。

## 7. 设计原则
1. 黑白极简：使用大面积留白、细线条，突出图表与数据；根据昼/夜模式调整背景灰度。
2. 信息优先级清晰：时间线 > 指标表 > 趋势图，确保复盘效率。
3. 快速回顾：任何图表点都能在 2 次点击内看到当日事件摘要。
4. 可控可迁移：所有设置清楚告知数据存放位置，导出文件结构清晰可读。

## 8. 里程碑
| 阶段 | 时间 | 产出 |
| --- | --- | --- |
| M0 需求确认 | 第 1 周 | PRD、原型、技术评估 |
| M1 MVP 实现 | 第 2-6 周 | 时间线 + 指标表 + 基础图表 + 本地文件引用 |
| M2 体验强化 | 第 7-10 周 | K 线交互、悬浮摘要、备份/导出、模版 |
| M3 扩展准备 | 第 11-14 周 | API 固化、插件接口、桌面端可行性验证 |

## 9. 未来展望
- 事件智能摘要（NLP 提取关键词、情绪）。
- 周/月报自动生成，支持分享或打印。
- 多人共享模式（家庭/团队），可区分权限。
- 与第三方服务联动：Apple Health、银行流水、任务管理工具等。

## 10. 低保真原型（HTML）
- `agent/diary.html`：日记页结构（时间线 + 当日概要）。
- `agent/sheets.html`：多 Sheet 表格与对应 K 线预览。
- `agent/trends.html`：单指标/聚合模式 K 线、热点悬浮与事件卡片。

---
通过上述方案，「K-Record」能够以 K 线形式记录自我发展趋势，实现事件与数据的深度联动，同时确保数据完全掌控并易于迁移，为未来多端同步奠定坚实基础。
